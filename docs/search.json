[
  {
    "objectID": "Results and Discussion.html",
    "href": "Results and Discussion.html",
    "title": "Results and Discussion",
    "section": "",
    "text": "library(here)\n\nWarning: package 'here' was built under R version 4.4.3\n\n\nhere() starts at C:/ESS330/git/Final-Project\n\nlibrary(readxl)\n\nWarning: package 'readxl' was built under R version 4.4.3\n\n# import Dataset as Tibble\ndata1 &lt;- read_excel(here(\"data\", \"Final_Data (1).xlsx\"), col_names = FALSE)\n\nNew names:\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n\n# change row 1 into column names\ncolnames(data1) &lt;- as.character(data1[1, ])\ndata1 &lt;- data1[-1, ]\n\n# Convert date (for reference column) from numeric to Date \ndata1$`Date (for Reference)` &lt;- as.Date(as.numeric(data1$`Date (for Reference)`), origin = \"1899-12-30\")\n\n\n\nTo make the data easier to analyze across multiple counties, we will pivot the data into a long format using tidyr.\n\nlibrary(dplyr)\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(tidyr)\n\n# Select only the relevant columns (SPI/DSCI + ENSO + Date)\nlong_data &lt;- data1 %&gt;%\n  select(`Date (for Reference)`, `ENSO Type`, `ENSO Severity`,\n         starts_with(\"Rolling SPI Average\"), starts_with(\"Rolling DSCI Average\")) %&gt;%\n  pivot_longer(cols = starts_with(\"Rolling\"),\n               names_to = \"Variable\",\n               values_to = \"Value\") %&gt;%\n  extract(Variable, into = c(\"Metric_Type\", \"County\"), regex = \"^(.*) ([^ ]+)$\")\n\ncolnames(long_data) &lt;- gsub(\" \", \"_\", colnames(long_data))\n\n# swap ENSO severity with ENSO type\nlong_data &lt;- long_data %&gt;%\n  rename(`Temp_Column` = `ENSO_Severity`)\n\nlong_data &lt;- long_data %&gt;%\n  rename(\n    `ENSO_Severity` = `ENSO_Type`,\n    `ENSO_Type` = `Temp_Column`\n  )\n# add underscores in all column names \ncolnames(long_data) &lt;- gsub(\" \", \"_\", colnames(long_data))\n\n# convert ENSO_severity and value to numeric\nlong_data$ENSO_Severity &lt;- as.numeric(long_data$ENSO_Severity)\nlong_data$Value &lt;- as.numeric(long_data$Value)\n\n\n\n\n\n\n\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(dplyr)\n\nggplot(long_data %&gt;% filter(Metric_Type == \"Rolling SPI Average\"),\n       aes(x = `ENSO_Severity`, y = Value, color = County)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(title = \"Relationship between ENSO Severity and Rolling SPI Average\",\n       x = \"ENSO Severity\", y = \"Rolling SPI Average\") +\n   scale_y_continuous(labels = number_format(accuracy = 0.01)) +  \n  scale_x_continuous(labels = number_format(accuracy = 0.1)) +   \n  theme_minimal()\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\nWarning: Removed 5 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n\n\n\n\nggplot(long_data %&gt;% filter(Metric_Type == \"Rolling DSCI Average\"),\n       aes(x = `ENSO_Severity`, y = Value, color = County)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(title = \"Relationship between ENSO Severity and Rolling DSCI Average\",\n       x = \"ENSO Severity\", y = \"Rolling DSCI Average\") +\n   scale_y_continuous(labels = number_format(accuracy = 0.01)) +  \n  scale_x_continuous(labels = number_format(accuracy = 0.1)) +   \n  theme_minimal()\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\nWarning: Removed 5 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Pearson correlation by county SPI\nSPI_cor_results &lt;- long_data %&gt;%\n  filter(Metric_Type == \"Rolling SPI Average\") %&gt;%\n  group_by(County) %&gt;%\n  summarise(correlation = cor(`ENSO_Severity`, Value, use = \"complete.obs\"),\n            .groups = \"drop\")\n\nprint(SPI_cor_results)\n\n# A tibble: 5 × 2\n  County   correlation\n  &lt;chr&gt;          &lt;dbl&gt;\n1 Carson       -0.140 \n2 Costilla      0.0790\n3 Larimer      -0.375 \n4 Mesa         -0.242 \n5 Park         -0.319 \n\n# Linear Regression by county SPI\nSPI_lm_results &lt;- long_data %&gt;%\n  filter(Metric_Type == \"Rolling SPI Average\") %&gt;%\n  group_by(County) %&gt;%\n  group_map(~ summary(lm(Value ~ `ENSO_Severity`, data = .x)))\n\nprint(SPI_lm_results)\n\n[[1]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-45.56 -27.28  -0.87  25.28  59.77 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     39.273      1.657  23.699   &lt;2e-16 ***\nENSO_Severity   -4.954      2.029  -2.441   0.0152 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 28.57 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.01973,   Adjusted R-squared:  0.01642 \nF-statistic: 5.959 on 1 and 296 DF,  p-value: 0.01523\n\n\n[[2]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-45.143 -29.330   1.103  24.033  58.012 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     39.543      1.719  23.002   &lt;2e-16 ***\nENSO_Severity    2.872      2.105   1.364    0.174    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 29.64 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.006246,  Adjusted R-squared:  0.002889 \nF-statistic:  1.86 on 1 and 296 DF,  p-value: 0.1736\n\n\n[[3]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-51.097 -17.323   0.354  18.033  46.559 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     39.257      1.300  30.201  &lt; 2e-16 ***\nENSO_Severity  -11.070      1.592  -6.954 2.28e-11 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 22.41 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.1404,    Adjusted R-squared:  0.1375 \nF-statistic: 48.36 on 1 and 296 DF,  p-value: 2.278e-11\n\n\n[[4]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-45.748 -27.327  -5.063  24.405  64.892 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     34.336      1.712  20.058  &lt; 2e-16 ***\nENSO_Severity   -8.986      2.096  -4.286 2.46e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 29.51 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.05844,   Adjusted R-squared:  0.05526 \nF-statistic: 18.37 on 1 and 296 DF,  p-value: 2.462e-05\n\n\n[[5]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-59.433 -16.474   2.837  19.641  43.611 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     46.458      1.442  32.220  &lt; 2e-16 ***\nENSO_Severity  -10.216      1.766  -5.785 1.84e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 24.86 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.1016,    Adjusted R-squared:  0.09855 \nF-statistic: 33.47 on 1 and 296 DF,  p-value: 1.842e-08\n\n\n\n# Pearson correlation by county DSCI\nDSCI_cor_results &lt;- long_data %&gt;%\n  filter(Metric_Type == \"Rolling DSCI Average\") %&gt;%\n  group_by(County) %&gt;%\n  summarise(correlation = cor(`ENSO_Severity`, Value, use = \"complete.obs\"),\n            .groups = \"drop\")\n\nprint(DSCI_cor_results)\n\n# A tibble: 5 × 2\n  County   correlation\n  &lt;chr&gt;          &lt;dbl&gt;\n1 Carson      -0.101  \n2 Costilla     0.0171 \n3 Larimer     -0.0696 \n4 Mesa         0.0733 \n5 Park        -0.00494\n\n# Linear Regression by county DSCI\nDSCI_lm_results &lt;- long_data %&gt;%\n  filter(Metric_Type == \"Rolling DSCI Average\") %&gt;%\n  group_by(County) %&gt;%\n  group_map(~ summary(lm(Value ~ `ENSO_Severity`, data = .x)))\n\nprint(DSCI_lm_results)\n\n[[1]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-139.89 -106.56  -42.28   79.67  333.84 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)    121.451      7.373  16.472   &lt;2e-16 ***\nENSO_Severity  -15.788      9.030  -1.748   0.0814 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 127.1 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.01022,   Adjusted R-squared:  0.006878 \nF-statistic: 3.057 on 1 and 296 DF,  p-value: 0.08143\n\n\n[[2]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-169.74 -132.88  -45.68  125.46  287.07 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)    161.882      8.276  19.561   &lt;2e-16 ***\nENSO_Severity    2.977     10.135   0.294    0.769    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 142.7 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.0002913, Adjusted R-squared:  -0.003086 \nF-statistic: 0.08625 on 1 and 296 DF,  p-value: 0.7692\n\n\n[[3]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-97.79 -78.12 -47.44  47.61 318.40 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     83.675      5.855   14.29   &lt;2e-16 ***\nENSO_Severity   -8.607      7.171   -1.20    0.231    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 100.9 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.004844,  Adjusted R-squared:  0.001482 \nF-statistic: 1.441 on 1 and 296 DF,  p-value: 0.231\n\n\n[[4]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-185.21 -120.34  -49.92  125.99  324.05 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)    151.301      8.311  18.204   &lt;2e-16 ***\nENSO_Severity   12.876     10.179   1.265    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 143.3 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.005377,  Adjusted R-squared:  0.002016 \nF-statistic:   1.6 on 1 and 296 DF,  p-value: 0.2069\n\n\n[[5]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-102.37  -96.88  -35.47   45.47  299.54 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)   101.3409     6.5117  15.563   &lt;2e-16 ***\nENSO_Severity  -0.6777     7.9750  -0.085    0.932    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 112.3 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  2.439e-05, Adjusted R-squared:  -0.003354 \nF-statistic: 0.007221 on 1 and 296 DF,  p-value: 0.9323\n\n\n\n\n\n\n# more data cleaning\n\nlibrary(dplyr)\n\ndata1 &lt;- data1 %&gt;%\n  rename(Date = `Date (for Reference)`)\n\nlong_data &lt;- long_data %&gt;%\n  rename(Date = `Date_(for_Reference)`)\n\nlong_data &lt;- long_data %&gt;%\n  left_join(data1 %&gt;% select(Date, Rolling_3_Month_Date = `Rolling 3 Month Date`), by = \"Date\")\n\n\n\n\n# Create a lookup table for center months of each rolling period\nperiod_centers &lt;- c(\n  \"JFM\" = \"02\", \"FMA\" = \"03\", \"MAM\" = \"04\", \"AMJ\" = \"05\",\n  \"MJJ\" = \"06\", \"JJA\" = \"07\", \"JAS\" = \"08\", \"ASO\" = \"09\",\n  \"SON\" = \"10\", \"OND\" = \"11\", \"NDJ\" = \"12\", \"DJF\" = \"01\"\n)\n\n# Add a \"centered\" date column\nlong_data &lt;- long_data %&gt;%\n  mutate(\n    center_month = period_centers[`Rolling_3_Month_Date`],\n    year = lubridate::year(Date),\n    rolling_date = as.Date(paste(year, center_month, \"15\", sep = \"-\"))\n  )\n\n\n\n\n\nlibrary(plotly)\n\nWarning: package 'plotly' was built under R version 4.4.3\n\n\n\nAttaching package: 'plotly'\n\n\nThe following object is masked from 'package:ggplot2':\n\n    last_plot\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\n\nThe following object is masked from 'package:graphics':\n\n    layout\n\nlong_data &lt;- long_data %&gt;%\n  mutate(\n    ENSO_Phase = case_when(\n      ENSO_Type %in% c(\"WE\", \"ME\", \"SE\", \"VSE\") ~ \"El Nino\",\n      ENSO_Type %in% c(\"WL\", \"ML\", \"SL\") ~ \"La Nina\",\n      ENSO_Type == \"NONE\" ~ \"Neutral\",\n      TRUE ~ NA_character_ \n    )\n  )\n\n\nenso_bands &lt;- long_data %&gt;%\n  select(rolling_date, ENSO_Phase) %&gt;%\n  distinct() %&gt;%\n  arrange(rolling_date) %&gt;%\n  mutate(group = cumsum(ENSO_Phase != lag(ENSO_Phase, default = first(ENSO_Phase)))) %&gt;%\n  group_by(group, ENSO_Phase) %&gt;%\n  summarise(start = min(rolling_date), end = max(rolling_date), .groups = \"drop\")\n\n\n\nggplot() +\n  geom_rect(data = enso_bands,\n            aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf, fill = ENSO_Phase),\n            alpha = 0.2) +\n  # SPI lines\n  geom_line(data = long_data %&gt;% filter(Metric_Type == \"Rolling SPI Average\"),\n            aes(x = rolling_date, y = Value, color = County)) +\n  scale_fill_manual(values = c(\"El Nino\" = \"red\", \"La Nina\" = \"blue\", \"Neutral\" = \"gray\")) +\n  labs(title = \"SPI with ENSO Phase Overlays\",\n       x = \"Date\", y = \"Rolling SPI Average\",\n       fill = \"ENSO Phase\", color = \"County\") +\n  theme_minimal()\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_rect()`).\n\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n# Faceted Trends \nggplot() +\n  # ENSO shaded bands across all facets\n  geom_rect(data = enso_bands,\n            aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf, fill = ENSO_Phase),\n            alpha = 0.2, inherit.aes = FALSE) +\n  # SPI time series line\n  geom_line(data = long_data %&gt;% filter(Metric_Type == \"Rolling SPI Average\"),\n            aes(x = rolling_date, y = Value, color = County)) +\n  facet_wrap(~County, scales = \"free_y\") +\n  scale_fill_manual(values = c(\"El Nino\" = \"red\", \"La Nina\" = \"blue\", \"Neutral\" = \"gray\")) +\n  labs(title = \"SPI Over Time with ENSO Phase Overlays\",\n       x = \"Date\", y = \"Rolling SPI Average\",\n       fill = \"ENSO Phase\", color = \"County\") +\n  theme_minimal()\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_rect()`).\nRemoved 5 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\n\n\n\n\nggplot() +\n  geom_rect(data = enso_bands,\n            aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf, fill = ENSO_Phase),\n            alpha = 0.2, inherit.aes = FALSE) +\n  geom_line(data = long_data %&gt;% filter(Metric_Type == \"Rolling DSCI Average\"),\n            aes(x = rolling_date, y = Value, color = County)) +\n  facet_wrap(~County, scales = \"free_y\") +\n  scale_fill_manual(values = c(\"El Nino\" = \"red\", \"La Nina\" = \"blue\", \"Neutral\" = \"gray\")) +\n  labs(title = \"DSCI Over Time with ENSO Phase Overlays\",\n       x = \"Date\", y = \"Rolling DSCI Average\",\n       fill = \"ENSO Phase\", color = \"County\") +\n  theme_minimal()\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_rect()`).\n\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_line()`)."
  },
  {
    "objectID": "Results and Discussion.html#methods",
    "href": "Results and Discussion.html#methods",
    "title": "Results and Discussion",
    "section": "",
    "text": "library(here)\n\nWarning: package 'here' was built under R version 4.4.3\n\n\nhere() starts at C:/ESS330/git/Final-Project\n\nlibrary(readxl)\n\nWarning: package 'readxl' was built under R version 4.4.3\n\n# import Dataset as Tibble\ndata1 &lt;- read_excel(here(\"data\", \"Final_Data (1).xlsx\"), col_names = FALSE)\n\nNew names:\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n• `` -&gt; `...3`\n• `` -&gt; `...4`\n• `` -&gt; `...5`\n• `` -&gt; `...6`\n• `` -&gt; `...7`\n• `` -&gt; `...8`\n• `` -&gt; `...9`\n• `` -&gt; `...10`\n• `` -&gt; `...11`\n• `` -&gt; `...12`\n• `` -&gt; `...13`\n• `` -&gt; `...14`\n• `` -&gt; `...15`\n• `` -&gt; `...16`\n• `` -&gt; `...17`\n• `` -&gt; `...18`\n• `` -&gt; `...19`\n• `` -&gt; `...20`\n• `` -&gt; `...21`\n• `` -&gt; `...22`\n• `` -&gt; `...23`\n• `` -&gt; `...24`\n\n# change row 1 into column names\ncolnames(data1) &lt;- as.character(data1[1, ])\ndata1 &lt;- data1[-1, ]\n\n# Convert date (for reference column) from numeric to Date \ndata1$`Date (for Reference)` &lt;- as.Date(as.numeric(data1$`Date (for Reference)`), origin = \"1899-12-30\")\n\n\n\nTo make the data easier to analyze across multiple counties, we will pivot the data into a long format using tidyr.\n\nlibrary(dplyr)\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(tidyr)\n\n# Select only the relevant columns (SPI/DSCI + ENSO + Date)\nlong_data &lt;- data1 %&gt;%\n  select(`Date (for Reference)`, `ENSO Type`, `ENSO Severity`,\n         starts_with(\"Rolling SPI Average\"), starts_with(\"Rolling DSCI Average\")) %&gt;%\n  pivot_longer(cols = starts_with(\"Rolling\"),\n               names_to = \"Variable\",\n               values_to = \"Value\") %&gt;%\n  extract(Variable, into = c(\"Metric_Type\", \"County\"), regex = \"^(.*) ([^ ]+)$\")\n\ncolnames(long_data) &lt;- gsub(\" \", \"_\", colnames(long_data))\n\n# swap ENSO severity with ENSO type\nlong_data &lt;- long_data %&gt;%\n  rename(`Temp_Column` = `ENSO_Severity`)\n\nlong_data &lt;- long_data %&gt;%\n  rename(\n    `ENSO_Severity` = `ENSO_Type`,\n    `ENSO_Type` = `Temp_Column`\n  )\n# add underscores in all column names \ncolnames(long_data) &lt;- gsub(\" \", \"_\", colnames(long_data))\n\n# convert ENSO_severity and value to numeric\nlong_data$ENSO_Severity &lt;- as.numeric(long_data$ENSO_Severity)\nlong_data$Value &lt;- as.numeric(long_data$Value)\n\n\n\n\n\n\n\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(dplyr)\n\nggplot(long_data %&gt;% filter(Metric_Type == \"Rolling SPI Average\"),\n       aes(x = `ENSO_Severity`, y = Value, color = County)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(title = \"Relationship between ENSO Severity and Rolling SPI Average\",\n       x = \"ENSO Severity\", y = \"Rolling SPI Average\") +\n   scale_y_continuous(labels = number_format(accuracy = 0.01)) +  \n  scale_x_continuous(labels = number_format(accuracy = 0.1)) +   \n  theme_minimal()\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\nWarning: Removed 5 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n\n\n\n\nggplot(long_data %&gt;% filter(Metric_Type == \"Rolling DSCI Average\"),\n       aes(x = `ENSO_Severity`, y = Value, color = County)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(title = \"Relationship between ENSO Severity and Rolling DSCI Average\",\n       x = \"ENSO Severity\", y = \"Rolling DSCI Average\") +\n   scale_y_continuous(labels = number_format(accuracy = 0.01)) +  \n  scale_x_continuous(labels = number_format(accuracy = 0.1)) +   \n  theme_minimal()\n\n`geom_smooth()` using formula = 'y ~ x'\n\n\nWarning: Removed 5 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# Pearson correlation by county SPI\nSPI_cor_results &lt;- long_data %&gt;%\n  filter(Metric_Type == \"Rolling SPI Average\") %&gt;%\n  group_by(County) %&gt;%\n  summarise(correlation = cor(`ENSO_Severity`, Value, use = \"complete.obs\"),\n            .groups = \"drop\")\n\nprint(SPI_cor_results)\n\n# A tibble: 5 × 2\n  County   correlation\n  &lt;chr&gt;          &lt;dbl&gt;\n1 Carson       -0.140 \n2 Costilla      0.0790\n3 Larimer      -0.375 \n4 Mesa         -0.242 \n5 Park         -0.319 \n\n# Linear Regression by county SPI\nSPI_lm_results &lt;- long_data %&gt;%\n  filter(Metric_Type == \"Rolling SPI Average\") %&gt;%\n  group_by(County) %&gt;%\n  group_map(~ summary(lm(Value ~ `ENSO_Severity`, data = .x)))\n\nprint(SPI_lm_results)\n\n[[1]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-45.56 -27.28  -0.87  25.28  59.77 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     39.273      1.657  23.699   &lt;2e-16 ***\nENSO_Severity   -4.954      2.029  -2.441   0.0152 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 28.57 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.01973,   Adjusted R-squared:  0.01642 \nF-statistic: 5.959 on 1 and 296 DF,  p-value: 0.01523\n\n\n[[2]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-45.143 -29.330   1.103  24.033  58.012 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     39.543      1.719  23.002   &lt;2e-16 ***\nENSO_Severity    2.872      2.105   1.364    0.174    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 29.64 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.006246,  Adjusted R-squared:  0.002889 \nF-statistic:  1.86 on 1 and 296 DF,  p-value: 0.1736\n\n\n[[3]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-51.097 -17.323   0.354  18.033  46.559 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     39.257      1.300  30.201  &lt; 2e-16 ***\nENSO_Severity  -11.070      1.592  -6.954 2.28e-11 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 22.41 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.1404,    Adjusted R-squared:  0.1375 \nF-statistic: 48.36 on 1 and 296 DF,  p-value: 2.278e-11\n\n\n[[4]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-45.748 -27.327  -5.063  24.405  64.892 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     34.336      1.712  20.058  &lt; 2e-16 ***\nENSO_Severity   -8.986      2.096  -4.286 2.46e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 29.51 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.05844,   Adjusted R-squared:  0.05526 \nF-statistic: 18.37 on 1 and 296 DF,  p-value: 2.462e-05\n\n\n[[5]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-59.433 -16.474   2.837  19.641  43.611 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     46.458      1.442  32.220  &lt; 2e-16 ***\nENSO_Severity  -10.216      1.766  -5.785 1.84e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 24.86 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.1016,    Adjusted R-squared:  0.09855 \nF-statistic: 33.47 on 1 and 296 DF,  p-value: 1.842e-08\n\n\n\n# Pearson correlation by county DSCI\nDSCI_cor_results &lt;- long_data %&gt;%\n  filter(Metric_Type == \"Rolling DSCI Average\") %&gt;%\n  group_by(County) %&gt;%\n  summarise(correlation = cor(`ENSO_Severity`, Value, use = \"complete.obs\"),\n            .groups = \"drop\")\n\nprint(DSCI_cor_results)\n\n# A tibble: 5 × 2\n  County   correlation\n  &lt;chr&gt;          &lt;dbl&gt;\n1 Carson      -0.101  \n2 Costilla     0.0171 \n3 Larimer     -0.0696 \n4 Mesa         0.0733 \n5 Park        -0.00494\n\n# Linear Regression by county DSCI\nDSCI_lm_results &lt;- long_data %&gt;%\n  filter(Metric_Type == \"Rolling DSCI Average\") %&gt;%\n  group_by(County) %&gt;%\n  group_map(~ summary(lm(Value ~ `ENSO_Severity`, data = .x)))\n\nprint(DSCI_lm_results)\n\n[[1]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-139.89 -106.56  -42.28   79.67  333.84 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)    121.451      7.373  16.472   &lt;2e-16 ***\nENSO_Severity  -15.788      9.030  -1.748   0.0814 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 127.1 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.01022,   Adjusted R-squared:  0.006878 \nF-statistic: 3.057 on 1 and 296 DF,  p-value: 0.08143\n\n\n[[2]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-169.74 -132.88  -45.68  125.46  287.07 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)    161.882      8.276  19.561   &lt;2e-16 ***\nENSO_Severity    2.977     10.135   0.294    0.769    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 142.7 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.0002913, Adjusted R-squared:  -0.003086 \nF-statistic: 0.08625 on 1 and 296 DF,  p-value: 0.7692\n\n\n[[3]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-97.79 -78.12 -47.44  47.61 318.40 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)     83.675      5.855   14.29   &lt;2e-16 ***\nENSO_Severity   -8.607      7.171   -1.20    0.231    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 100.9 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.004844,  Adjusted R-squared:  0.001482 \nF-statistic: 1.441 on 1 and 296 DF,  p-value: 0.231\n\n\n[[4]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-185.21 -120.34  -49.92  125.99  324.05 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)    151.301      8.311  18.204   &lt;2e-16 ***\nENSO_Severity   12.876     10.179   1.265    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 143.3 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.005377,  Adjusted R-squared:  0.002016 \nF-statistic:   1.6 on 1 and 296 DF,  p-value: 0.2069\n\n\n[[5]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-102.37  -96.88  -35.47   45.47  299.54 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)   101.3409     6.5117  15.563   &lt;2e-16 ***\nENSO_Severity  -0.6777     7.9750  -0.085    0.932    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 112.3 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  2.439e-05, Adjusted R-squared:  -0.003354 \nF-statistic: 0.007221 on 1 and 296 DF,  p-value: 0.9323\n\n\n\n\n\n\n# more data cleaning\n\nlibrary(dplyr)\n\ndata1 &lt;- data1 %&gt;%\n  rename(Date = `Date (for Reference)`)\n\nlong_data &lt;- long_data %&gt;%\n  rename(Date = `Date_(for_Reference)`)\n\nlong_data &lt;- long_data %&gt;%\n  left_join(data1 %&gt;% select(Date, Rolling_3_Month_Date = `Rolling 3 Month Date`), by = \"Date\")\n\n\n\n\n# Create a lookup table for center months of each rolling period\nperiod_centers &lt;- c(\n  \"JFM\" = \"02\", \"FMA\" = \"03\", \"MAM\" = \"04\", \"AMJ\" = \"05\",\n  \"MJJ\" = \"06\", \"JJA\" = \"07\", \"JAS\" = \"08\", \"ASO\" = \"09\",\n  \"SON\" = \"10\", \"OND\" = \"11\", \"NDJ\" = \"12\", \"DJF\" = \"01\"\n)\n\n# Add a \"centered\" date column\nlong_data &lt;- long_data %&gt;%\n  mutate(\n    center_month = period_centers[`Rolling_3_Month_Date`],\n    year = lubridate::year(Date),\n    rolling_date = as.Date(paste(year, center_month, \"15\", sep = \"-\"))\n  )\n\n\n\n\n\nlibrary(plotly)\n\nWarning: package 'plotly' was built under R version 4.4.3\n\n\n\nAttaching package: 'plotly'\n\n\nThe following object is masked from 'package:ggplot2':\n\n    last_plot\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\n\nThe following object is masked from 'package:graphics':\n\n    layout\n\nlong_data &lt;- long_data %&gt;%\n  mutate(\n    ENSO_Phase = case_when(\n      ENSO_Type %in% c(\"WE\", \"ME\", \"SE\", \"VSE\") ~ \"El Nino\",\n      ENSO_Type %in% c(\"WL\", \"ML\", \"SL\") ~ \"La Nina\",\n      ENSO_Type == \"NONE\" ~ \"Neutral\",\n      TRUE ~ NA_character_ \n    )\n  )\n\n\nenso_bands &lt;- long_data %&gt;%\n  select(rolling_date, ENSO_Phase) %&gt;%\n  distinct() %&gt;%\n  arrange(rolling_date) %&gt;%\n  mutate(group = cumsum(ENSO_Phase != lag(ENSO_Phase, default = first(ENSO_Phase)))) %&gt;%\n  group_by(group, ENSO_Phase) %&gt;%\n  summarise(start = min(rolling_date), end = max(rolling_date), .groups = \"drop\")\n\n\n\nggplot() +\n  geom_rect(data = enso_bands,\n            aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf, fill = ENSO_Phase),\n            alpha = 0.2) +\n  # SPI lines\n  geom_line(data = long_data %&gt;% filter(Metric_Type == \"Rolling SPI Average\"),\n            aes(x = rolling_date, y = Value, color = County)) +\n  scale_fill_manual(values = c(\"El Nino\" = \"red\", \"La Nina\" = \"blue\", \"Neutral\" = \"gray\")) +\n  labs(title = \"SPI with ENSO Phase Overlays\",\n       x = \"Date\", y = \"Rolling SPI Average\",\n       fill = \"ENSO Phase\", color = \"County\") +\n  theme_minimal()\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_rect()`).\n\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n# Faceted Trends \nggplot() +\n  # ENSO shaded bands across all facets\n  geom_rect(data = enso_bands,\n            aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf, fill = ENSO_Phase),\n            alpha = 0.2, inherit.aes = FALSE) +\n  # SPI time series line\n  geom_line(data = long_data %&gt;% filter(Metric_Type == \"Rolling SPI Average\"),\n            aes(x = rolling_date, y = Value, color = County)) +\n  facet_wrap(~County, scales = \"free_y\") +\n  scale_fill_manual(values = c(\"El Nino\" = \"red\", \"La Nina\" = \"blue\", \"Neutral\" = \"gray\")) +\n  labs(title = \"SPI Over Time with ENSO Phase Overlays\",\n       x = \"Date\", y = \"Rolling SPI Average\",\n       fill = \"ENSO Phase\", color = \"County\") +\n  theme_minimal()\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_rect()`).\nRemoved 5 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\n\n\n\n\nggplot() +\n  geom_rect(data = enso_bands,\n            aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf, fill = ENSO_Phase),\n            alpha = 0.2, inherit.aes = FALSE) +\n  geom_line(data = long_data %&gt;% filter(Metric_Type == \"Rolling DSCI Average\"),\n            aes(x = rolling_date, y = Value, color = County)) +\n  facet_wrap(~County, scales = \"free_y\") +\n  scale_fill_manual(values = c(\"El Nino\" = \"red\", \"La Nina\" = \"blue\", \"Neutral\" = \"gray\")) +\n  labs(title = \"DSCI Over Time with ENSO Phase Overlays\",\n       x = \"Date\", y = \"Rolling DSCI Average\",\n       fill = \"ENSO Phase\", color = \"County\") +\n  theme_minimal()\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_rect()`).\n\n\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_line()`)."
  }
]