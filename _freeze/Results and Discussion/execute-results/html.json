{
  "hash": "e4150546a124b2f965733282e7eb2094",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lab 9: Results and Discussion Draft\"\nauthor:\n  - name: \"Leila Aburomia\"\n    corresponding: true\n  - name: \"Aldair Perez\"\n  - name: \"Noah Goodhart\"\nformat: html\nexecute: \n  echo: true\n---\n\n\n\n## ENSO-Drought Linkages in Colorado Counties: A Statistical Perspective\n\n# Introduction\n\nOver the past decade, the western United States has experienced hydroclimatic variability that has emerged as a dominant environmental issue of great concern (@Balling2007). Since 1996, a considerable portion of the western U.S. has seen drought conditions that are similar in scale to the historical droughts in the 1930s and 1950s (@Balling2007). Studies have also used the paleoclimatic record to reveal evidence of long term droughts over the past 500 to 2,000 years (@Woodhouse1998). Hydroclimatic variability studies range in scale from regional to watershed. This variability is often complex and may require a multitude of scales to fully understand and plan for future drought conditions. In the dry western U.S., Colorado receives less than 17 inches of average annual precipitation statewide. (@Mckee2000). In comparison to the rest of the United States, these rainfall amounts are incredibly sparse. Luckily, Colorado’s Rocky Mountains help alleviate potential water stress by collecting more than 25 inches of precipitation annually (@Mckee2000). By successfully adapting to this dry climate, Colorado supports a massive agricultural and recreational industry and multiple growing urban centers (@Mckee2000). As population and industry grow, the threat of drought and its social, economic, and environmental impacts increase as well. Measuring and assessing drought accurately is essential for future planning. Historical drought data can give valuable insight into influences or indicators of drought conditions. Patterns of climatic variability that aligned with droughts in the past can help our society better prepare for the future. One of these patterns is the influential El Nino and La Nina. El Nino is caused by a warming of the tropical Pacific Ocean that occurs about every three to seven years and lasts for 12-18 months (@McPhaden2002). La Nina is akin to El Nino with stronger than normal trade winds and cooler tropical Pacific water temperatures (@McPhaden2002). In recent decades, the El Nino/Southern Oscillation (ENSO) has been more closely monitored, and the strength of each cycle has been documented. The effects of El Nino and La Nina on climate vary considerably across the globe, but in the western U.S., there is a pattern of impacts. During El Nino years, both extremely wet and dry conditions can be expected, while La Nina years are characterized by only dry conditions (@Canon2007). This research aims to analyze interactions between climatic variability indicating drought and the ENSO cycle. To examine interactions between drought conditions and the El Nino/Southern Oscillation (ENSO), we will utilize a variety of climatic data. To create a framework for drought, we will use the Standardized Precipitation Index (SPI) from the National Integrated Drought Information System to measure how much observed precipitation deviated from the climatological average. This condition can be measured on a variety of time scales, indicating that the SPI can be useful for both short-term and long-term applications (@NASA). The unit of SPI can be interpreted as “standard deviations”. We will also use the Drought Monitor of Colorado from the USDM to assess the severity and extent of drought using their standardized classification system. This data uses six classifications to characterize drought severity: normal conditions, abnormally dry (D0), and four levels of drought (D1 to D4) representing moderate, severe, extreme, and exceptional drought conditions, respectively. Lastly, we will utilize SNOTEL snow pack data from the Natural Resource Conservation Service to supplement our drought framework. In order to compare this data to ENSO cycles, we will examine El Niño and La Niña intensities for each year based on the Oceanic Nino Index (ONI). This index is the standard for NOAA used to classify El Nino and La Nina events in the eastern tropical Pacific (@Null). Events are defined as five consecutive 3-month periods at or above the + 0.5 degrees threshold for warm (El Nino) events and at or below the - 0.5 degrees anomaly for cool (La Nina) events (@Null). To find correlations between our drought framework and ENSO cycles, we will use R software to conduct statistical tests. First, we will preprocess our data by aligning datasets by date. For snowpack and SPI we will standardize to monthly averages and for drought monitor, we will summarize weekly data to monthly. Our statistical methods will include a correlation analysis to test correlations between ENSO index (ONI) and drought variables. We will use the Pearson correlation coefficient to measure the linear relationship. Then we will use ggplot2 to visualize the trends in a scatter plot and add a linear regression line to help visualize the relationship. If the correlation is significant, we will perform a correlation hypothesis test to provide us with the correlation coefficient and p-value. Next, we will conduct a time series analysis of cross-correlation to look for lagged effects of ENSO on drought parameters. We will also use a linear regression model to model SPI and snowpack as a function of ONI. In conclusion, these findings will help us find a relationship between El Nino/La Nina and drought in Colorado. If so, we can produce the evidence through statistical findings and visual representations, such as a scatter plot and a linear regression model. Considering we are living in a society becoming more conscious about climate change and its environmental impacts, such as more extreme drought events, this project will enforce our involvement in the understanding aspects of our global environment and comprehend to an extent on how global processes impact extreme weather.\n\n## Materials\n\nFor our introduction, we used background literature on what ENSO is and how it is measured along with information about SPI and DSCI, including, what they are, how they are calculated, and their significance in drought monitoring. For our methods, our necessary data included ENSO data from Oceanic Nino Index (ONI), precipitation data in the form of Standardized Precipitation Index (SPI) from drought.gov and Drought Severity and Coverage Index (DSCI) from US drought monitor. Our Rstudio packages we utilized for our data analysis included; \"here\", \"readxl\", \"dplyr\", \"tidyr\", \"ggplot2\", and \"scales\". Lastly, we used Rstudio and Quarto to create and report generation of our project.\n\n# Results\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'here' was built under R version 4.4.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nhere() starts at C:/ESS330/git/Final-Project\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(readxl)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'readxl' was built under R version 4.4.3\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n# import Dataset as Tibble\ndata1 <- read_excel(here(\"data\", \"Final_Data (1).xlsx\"), col_names = FALSE)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nNew names:\n• `` -> `...1`\n• `` -> `...2`\n• `` -> `...3`\n• `` -> `...4`\n• `` -> `...5`\n• `` -> `...6`\n• `` -> `...7`\n• `` -> `...8`\n• `` -> `...9`\n• `` -> `...10`\n• `` -> `...11`\n• `` -> `...12`\n• `` -> `...13`\n• `` -> `...14`\n• `` -> `...15`\n• `` -> `...16`\n• `` -> `...17`\n• `` -> `...18`\n• `` -> `...19`\n• `` -> `...20`\n• `` -> `...21`\n• `` -> `...22`\n• `` -> `...23`\n• `` -> `...24`\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n# change row 1 into column names\ncolnames(data1) <- as.character(data1[1, ])\ndata1 <- data1[-1, ]\n\n# Convert date (for reference column) from numeric to Date \ndata1$`Date (for Reference)` <- as.Date(as.numeric(data1$`Date (for Reference)`), origin = \"1899-12-30\")\n```\n:::\n\n\n\n### Clean and Reshape Data\n\nTo make the data easier to analyze across multiple counties, we will pivot the data into a long format using tidyr.\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(tidyr)\n\n# Select only the relevant columns (SPI/DSCI + ENSO + Date)\nlong_data <- data1 %>%\n  select(`Date (for Reference)`, `ENSO Type`, `ENSO Severity`,\n         starts_with(\"Rolling SPI Average\"), starts_with(\"Rolling DSCI Average\")) %>%\n  pivot_longer(cols = starts_with(\"Rolling\"),\n               names_to = \"Variable\",\n               values_to = \"Value\") %>%\n  extract(Variable, into = c(\"Metric_Type\", \"County\"), regex = \"^(.*) ([^ ]+)$\")\n\ncolnames(long_data) <- gsub(\" \", \"_\", colnames(long_data))\n\n# swap ENSO severity with ENSO type\nlong_data <- long_data %>%\n  rename(`Temp_Column` = `ENSO_Severity`)\n\nlong_data <- long_data %>%\n  rename(\n    `ENSO_Severity` = `ENSO_Type`,\n    `ENSO_Type` = `Temp_Column`\n  )\n# add underscores in all column names \ncolnames(long_data) <- gsub(\" \", \"_\", colnames(long_data))\n\n# convert ENSO_severity and value to numeric\nlong_data$ENSO_Severity <- as.numeric(long_data$ENSO_Severity)\nlong_data$Value <- as.numeric(long_data$Value)\n```\n:::\n\n\n\n### Visualization of relationships between ENSO severity and SPI/DSCI per county\n\n#### ENSO severity and Rolling SPI Average\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(dplyr)\n\nggplot(long_data %>% filter(Metric_Type == \"Rolling SPI Average\"),\n       aes(x = `ENSO_Severity`, y = Value, color = County)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(title = \"Relationship between ENSO Severity and Rolling SPI Average\",\n       x = \"ENSO Severity\", y = \"Rolling SPI Average\") +\n   scale_y_continuous(labels = number_format(accuracy = 0.01)) +  \n  scale_x_continuous(labels = number_format(accuracy = 0.1)) +   \n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 5 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Results-and-Discussion_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n#### ENSO Severity and Rolling DSCI Average\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nggplot(long_data %>% filter(Metric_Type == \"Rolling DSCI Average\"),\n       aes(x = `ENSO_Severity`, y = Value, color = County)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n  labs(title = \"Relationship between ENSO Severity and Rolling DSCI Average\",\n       x = \"ENSO Severity\", y = \"Rolling DSCI Average\") +\n   scale_y_continuous(labels = number_format(accuracy = 0.01)) +  \n  scale_x_continuous(labels = number_format(accuracy = 0.1)) +   \n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 5 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Results-and-Discussion_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n### Statistical Tests\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Pearson correlation by county SPI\nSPI_cor_results <- long_data %>%\n  filter(Metric_Type == \"Rolling SPI Average\") %>%\n  group_by(County) %>%\n  summarise(correlation = cor(`ENSO_Severity`, Value, use = \"complete.obs\"),\n            .groups = \"drop\")\n\nprint(SPI_cor_results)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  County   correlation\n  <chr>          <dbl>\n1 Carson       -0.140 \n2 Costilla      0.0790\n3 Larimer      -0.375 \n4 Mesa         -0.242 \n5 Park         -0.319 \n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n# Linear Regression by county SPI\nSPI_lm_results <- long_data %>%\n  filter(Metric_Type == \"Rolling SPI Average\") %>%\n  group_by(County) %>%\n  group_map(~ summary(lm(Value ~ `ENSO_Severity`, data = .x)))\n\nprint(SPI_lm_results)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-45.56 -27.28  -0.87  25.28  59.77 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     39.273      1.657  23.699   <2e-16 ***\nENSO_Severity   -4.954      2.029  -2.441   0.0152 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 28.57 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.01973,\tAdjusted R-squared:  0.01642 \nF-statistic: 5.959 on 1 and 296 DF,  p-value: 0.01523\n\n\n[[2]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-45.143 -29.330   1.103  24.033  58.012 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     39.543      1.719  23.002   <2e-16 ***\nENSO_Severity    2.872      2.105   1.364    0.174    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 29.64 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.006246,\tAdjusted R-squared:  0.002889 \nF-statistic:  1.86 on 1 and 296 DF,  p-value: 0.1736\n\n\n[[3]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-51.097 -17.323   0.354  18.033  46.559 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     39.257      1.300  30.201  < 2e-16 ***\nENSO_Severity  -11.070      1.592  -6.954 2.28e-11 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 22.41 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.1404,\tAdjusted R-squared:  0.1375 \nF-statistic: 48.36 on 1 and 296 DF,  p-value: 2.278e-11\n\n\n[[4]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-45.748 -27.327  -5.063  24.405  64.892 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     34.336      1.712  20.058  < 2e-16 ***\nENSO_Severity   -8.986      2.096  -4.286 2.46e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 29.51 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.05844,\tAdjusted R-squared:  0.05526 \nF-statistic: 18.37 on 1 and 296 DF,  p-value: 2.462e-05\n\n\n[[5]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-59.433 -16.474   2.837  19.641  43.611 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     46.458      1.442  32.220  < 2e-16 ***\nENSO_Severity  -10.216      1.766  -5.785 1.84e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 24.86 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.1016,\tAdjusted R-squared:  0.09855 \nF-statistic: 33.47 on 1 and 296 DF,  p-value: 1.842e-08\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Pearson correlation by county DSCI\nDSCI_cor_results <- long_data %>%\n  filter(Metric_Type == \"Rolling DSCI Average\") %>%\n  group_by(County) %>%\n  summarise(correlation = cor(`ENSO_Severity`, Value, use = \"complete.obs\"),\n            .groups = \"drop\")\n\nprint(DSCI_cor_results)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  County   correlation\n  <chr>          <dbl>\n1 Carson      -0.101  \n2 Costilla     0.0171 \n3 Larimer     -0.0696 \n4 Mesa         0.0733 \n5 Park        -0.00494\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n# Linear Regression by county DSCI\nDSCI_lm_results <- long_data %>%\n  filter(Metric_Type == \"Rolling DSCI Average\") %>%\n  group_by(County) %>%\n  group_map(~ summary(lm(Value ~ `ENSO_Severity`, data = .x)))\n\nprint(DSCI_lm_results)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-139.89 -106.56  -42.28   79.67  333.84 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    121.451      7.373  16.472   <2e-16 ***\nENSO_Severity  -15.788      9.030  -1.748   0.0814 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 127.1 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.01022,\tAdjusted R-squared:  0.006878 \nF-statistic: 3.057 on 1 and 296 DF,  p-value: 0.08143\n\n\n[[2]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-169.74 -132.88  -45.68  125.46  287.07 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    161.882      8.276  19.561   <2e-16 ***\nENSO_Severity    2.977     10.135   0.294    0.769    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 142.7 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.0002913,\tAdjusted R-squared:  -0.003086 \nF-statistic: 0.08625 on 1 and 296 DF,  p-value: 0.7692\n\n\n[[3]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-97.79 -78.12 -47.44  47.61 318.40 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     83.675      5.855   14.29   <2e-16 ***\nENSO_Severity   -8.607      7.171   -1.20    0.231    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 100.9 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.004844,\tAdjusted R-squared:  0.001482 \nF-statistic: 1.441 on 1 and 296 DF,  p-value: 0.231\n\n\n[[4]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-185.21 -120.34  -49.92  125.99  324.05 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)    151.301      8.311  18.204   <2e-16 ***\nENSO_Severity   12.876     10.179   1.265    0.207    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 143.3 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  0.005377,\tAdjusted R-squared:  0.002016 \nF-statistic:   1.6 on 1 and 296 DF,  p-value: 0.2069\n\n\n[[5]]\n\nCall:\nlm(formula = Value ~ ENSO_Severity, data = .x)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-102.37  -96.88  -35.47   45.47  299.54 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   101.3409     6.5117  15.563   <2e-16 ***\nENSO_Severity  -0.6777     7.9750  -0.085    0.932    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 112.3 on 296 degrees of freedom\n  (1 observation deleted due to missingness)\nMultiple R-squared:  2.439e-05,\tAdjusted R-squared:  -0.003354 \nF-statistic: 0.007221 on 1 and 296 DF,  p-value: 0.9323\n```\n\n\n:::\n:::\n\n\n\n### Time Series Plots\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# more data cleaning\n\nlibrary(dplyr)\n\ndata1 <- data1 %>%\n  rename(Date = `Date (for Reference)`)\n\nlong_data <- long_data %>%\n  rename(Date = `Date_(for_Reference)`)\n\nlong_data <- long_data %>%\n  left_join(data1 %>% select(Date, Rolling_3_Month_Date = `Rolling 3 Month Date`), by = \"Date\")\n```\n:::\n\n\n\n#### Create a \"Center Date\" for the Rolling 3-Month Period\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Create a lookup table for center months of each rolling period\nperiod_centers <- c(\n  \"JFM\" = \"02\", \"FMA\" = \"03\", \"MAM\" = \"04\", \"AMJ\" = \"05\",\n  \"MJJ\" = \"06\", \"JJA\" = \"07\", \"JAS\" = \"08\", \"ASO\" = \"09\",\n  \"SON\" = \"10\", \"OND\" = \"11\", \"NDJ\" = \"12\", \"DJF\" = \"01\"\n)\n\n# Add a \"centered\" date column\nlong_data <- long_data %>%\n  mutate(\n    center_month = period_centers[`Rolling_3_Month_Date`],\n    year = lubridate::year(Date),\n    rolling_date = as.Date(paste(year, center_month, \"15\", sep = \"-\"))\n  )\n```\n:::\n\n\n\n#### Time Series Visualizations for SPI and ENSO\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlong_data <- long_data %>%\n  mutate(\n    ENSO_Phase = case_when(\n      ENSO_Type %in% c(\"WE\", \"ME\", \"SE\", \"VSE\") ~ \"El Nino\",\n      ENSO_Type %in% c(\"WL\", \"ML\", \"SL\") ~ \"La Nina\",\n      ENSO_Type == \"NONE\" ~ \"Neutral\",\n      TRUE ~ NA_character_ \n    )\n  )\n\nenso_bands <- long_data %>%\n  select(rolling_date, ENSO_Phase) %>%\n  distinct() %>%\n  arrange(rolling_date) %>%\n  mutate(group = cumsum(ENSO_Phase != lag(ENSO_Phase, default = first(ENSO_Phase)))) %>%\n  group_by(group, ENSO_Phase) %>%\n  summarise(start = min(rolling_date), end = max(rolling_date), .groups = \"drop\")\n\nggplot() +\n  geom_rect(data = enso_bands,\n            aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf, fill = ENSO_Phase),\n            alpha = 0.2) +\n  # SPI lines\n  geom_line(data = long_data %>% filter(Metric_Type == \"Rolling SPI Average\"),\n            aes(x = rolling_date, y = Value, color = County)) +\n  scale_fill_manual(values = c(\"El Nino\" = \"red\", \"La Nina\" = \"blue\", \"Neutral\" = \"gray\")) +\n  labs(title = \"SPI with ENSO Phase Overlays\",\n       x = \"Date\", y = \"Rolling SPI Average\",\n       fill = \"ENSO Phase\", color = \"County\") +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_rect()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_line()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Results-and-Discussion_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code .hidden}\n# Faceted Trends \nggplot() +\n  # ENSO shaded bands across all facets\n  geom_rect(data = enso_bands,\n            aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf, fill = ENSO_Phase),\n            alpha = 0.2, inherit.aes = FALSE) +\n  # SPI time series line\n  geom_line(data = long_data %>% filter(Metric_Type == \"Rolling SPI Average\"),\n            aes(x = rolling_date, y = Value, color = County)) +\n  facet_wrap(~County, scales = \"free_y\") +\n  scale_fill_manual(values = c(\"El Nino\" = \"red\", \"La Nina\" = \"blue\", \"Neutral\" = \"gray\")) +\n  labs(title = \"SPI Over Time with ENSO Phase Overlays\",\n       x = \"Date\", y = \"Rolling SPI Average\",\n       fill = \"ENSO Phase\", color = \"County\") +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_rect()`).\nRemoved 5 rows containing missing values or values outside the scale range\n(`geom_line()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Results-and-Discussion_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n:::\n\n\n\n#### Time Series Visualizations for DSCI and ENSO\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nggplot() +\n  geom_rect(data = enso_bands,\n            aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf, fill = ENSO_Phase),\n            alpha = 0.2, inherit.aes = FALSE) +\n  geom_line(data = long_data %>% filter(Metric_Type == \"Rolling DSCI Average\"),\n            aes(x = rolling_date, y = Value, color = County)) +\n  facet_wrap(~County, scales = \"free_y\") +\n  scale_fill_manual(values = c(\"El Nino\" = \"red\", \"La Nina\" = \"blue\", \"Neutral\" = \"gray\")) +\n  labs(title = \"DSCI Over Time with ENSO Phase Overlays\",\n       x = \"Date\", y = \"Rolling DSCI Average\",\n       fill = \"ENSO Phase\", color = \"County\") +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_rect()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 5 rows containing missing values or values outside the scale range\n(`geom_line()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Results-and-Discussion_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Results-and-Discussion_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}